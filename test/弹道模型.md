

## 弹道模型

仅考虑水平方向空气阻力的作用，空气阻力与速度的平方成正比: 
$$
|f| = k v_x^2
$$


水平方向动力学模型:
$$
-k v_x^2 = m \frac{dv_x}{dt}
$$
初始条件 $v_x(0) = v_{x|0}$ 可求积分：
$$
- \frac{k}{m} dt = \frac{1} {v_x^2} dv_x 
\\
- \frac{k} {m} \int_0^{t} dt 
= 
\int_{v_{x|0}}^{v_x(t)} - \frac{1} {v_x} dv_x
$$
设 $k_1 = k / m$。可得：
$$
v_x(t) = \frac{v_{x|0}} {k_1 v_{x|0} t + 1}
$$
然后水平速度 $v_x(t)$ 对时间 t 积分的水平位移 $x(t)$ :
$$
x(t) = \int_0^t v_x(\tau) d\tau = \frac{1} {k_1} \ln(k_1 v_{x|0} t + 1)
$$
因为目标会移动，根据水平距离 $x$ 与水平速度 $x'$ ，可得到弹丸飞行时间 $T$ 满足：
$$
x + x' T = x(T) = \frac{1} {k_1} \ln(k_1 v_{x|0} T + 1)
$$
利用**牛顿迭代法**求解飞行时间 $T$ ，定义函数：
$$
f(t) = x(t) - x - x't
= 
\frac{1} {k_1} \ln(k_1 v_{x|0} t + 1) - x - x't
$$
有：
$$
f'(t) = \frac{v_{x|0}} {k_1 v_{x|0} t + 1} - x'
$$
迭代公式：
$$
T_0 = 0 \\
T_{k+1} = T_{k} - \frac{f(T_k)} {f'(t_k)}
$$


综上，云台应瞄准经过 $T$ 秒后目标的位置，**期望航向角** $\psi$ ,相当于 $pitch轴角度$ ：
$$
\psi = arctan( \frac{y + y'T} {x + x'T})
$$

## 弹道补偿

由于弹丸飞行过程中会受重力影响发生下坠，因此需要太高相应的角度。

弹丸落点高度 $h$， 可由 弹丸飞行时间 $T$ 、弹丸初速度 $v_0$、俯仰角 $\theta$ 求出：
$$
h_k = v_0 \sin \theta_k T - \frac{9.8} {2} T^2 
$$
经过弹丸飞行时间 $T$ 后，目标实际高度 $h_r = z + z' T$，定义误差 $e_k$ ：
$$
e_k = h_r - h_k
$$
其中 $h_k$ 为第k次迭代落点高度。补偿流程图：





## 不足之处

由于为考虑竖直方向空气阻力，因此在大仰角射击时误差较大（如：地面击打哨兵），考虑添加一个简单的高度补偿。
